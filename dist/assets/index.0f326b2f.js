import{f as e}from"./vendor.519c7c38.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(a){const c=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((a,o)=>{const d=new URL(e,c);if(self[t].moduleMap[d])return a(self[t].moduleMap[d]);const s=new Blob([`import * as m from '${d}';`,`${t}.moduleMap['${d}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(s),onerror(){o(new Error(`Failed to import: ${e}`)),n(r)},onload(){a(self[t].moduleMap[d]),n(r)}});document.head.appendChild(r)})),self[t].moduleMap={}}}("/assets/");const t={apiKey:"AIzaSyDxj7h-jJmroLl8hqrxlJOkFLji20H5ovs",authDomain:"videochat-3de3c.firebaseapp.com",projectId:"videochat-3de3c",storageBucket:"videochat-3de3c.appspot.com",messagingSenderId:"874522306310",appId:"1:874522306310:web:f6eab68621355847782087"};e.apps.length||e.initializeApp(t);const a=e.firestore(),c=new RTCPeerConnection({iceServers:[{urls:"stun:stun.relay.metered.ca:80"},{urls:"turn:a.relay.metered.ca:80",username:"c10fe7103a699715c64f12c5",credential:"omCMfjnocoNTJWlq"},{urls:"turn:a.relay.metered.ca:80?transport=tcp",username:"c10fe7103a699715c64f12c5",credential:"omCMfjnocoNTJWlq"},{urls:"turn:a.relay.metered.ca:443",username:"c10fe7103a699715c64f12c5",credential:"omCMfjnocoNTJWlq"},{urls:"turn:a.relay.metered.ca:443?transport=tcp",username:"c10fe7103a699715c64f12c5",credential:"omCMfjnocoNTJWlq"}],iceCandidatePoolSize:10});let n=null,o=null;const d=document.getElementById("webcamButton"),s=document.getElementById("webcamVideo"),r=document.getElementById("callButton"),i=document.getElementById("callInput"),l=document.getElementById("answerButton"),m=document.getElementById("remoteVideo"),p=document.getElementById("hangupButton");d.onclick=async()=>{n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),o=new MediaStream,n.getTracks().forEach((e=>{c.addTrack(e,n)})),c.ontrack=e=>{e.streams[0].getTracks().forEach((e=>{o.addTrack(e)}))},s.srcObject=n,m.srcObject=o,r.disabled=!1,l.disabled=!1,d.disabled=!0},r.onclick=async()=>{const e=a.collection("calls").doc(),t=e.collection("offerCandidates"),n=e.collection("answerCandidates");i.value=e.id,c.onicecandidate=e=>{e.candidate&&t.add(e.candidate.toJSON())};const o=await c.createOffer();await c.setLocalDescription(o);const d={sdp:o.sdp,type:o.type};await e.set({offer:d}),e.onSnapshot((e=>{const t=e.data();if(!c.currentRemoteDescription&&(null==t?void 0:t.answer)){const e=new RTCSessionDescription(t.answer);c.setRemoteDescription(e)}})),n.onSnapshot((e=>{e.docChanges().forEach((e=>{if("added"===e.type){const t=new RTCIceCandidate(e.doc.data());c.addIceCandidate(t)}}))})),p.disabled=!1},l.onclick=async()=>{const e=i.value,t=a.collection("calls").doc(e),n=t.collection("answerCandidates"),o=t.collection("offerCandidates");c.onicecandidate=e=>{e.candidate&&n.add(e.candidate.toJSON())};const d=(await t.get()).data().offer;await c.setRemoteDescription(new RTCSessionDescription(d));const s=await c.createAnswer();await c.setLocalDescription(s);const r={type:s.type,sdp:s.sdp};await t.update({answer:r}),o.onSnapshot((e=>{e.docChanges().forEach((e=>{if(console.log(e),"added"===e.type){let t=e.doc.data();c.addIceCandidate(new RTCIceCandidate(t))}}))}))};
